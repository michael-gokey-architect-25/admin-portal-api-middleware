# admin-portal-api/src/main/resources/application.yml

# ============================================================================
# PURPOSE: Main Spring Boot configuration file
# - Defines application name, logging, server settings
# - Includes profile-specific configurations (dev, prod)
# - Sets up database connection and JPA/Hibernate settings
# KEY CONCEPTS:
# 1. Profiles: Different configurations for different environments (dev/prod)
# 2. Logging Levels: Control verbosity of application logs
# 3. Server Configuration: Port, servlet context path, error handling
# 4. Database Properties: Connection pool, validation, initialization
# TEACHING NOTES:
# - Spring Boot uses "application.properties" or "application.yml" format
# - Profile-specific files override base configuration
# - Properties can be injected via @Value or @ConfigurationProperties
# Interesting that Angular is gettign away from envirnmentals
# ============================================================================

spring:
  application:
    name: admin-portal-api
    version: 1.0.0

  # ==================== JPA/HIBERNATE ====================
  # Object-Relational Mapping (ORM) configuration
  jpa:
    # Hibernate dialect - optimizes SQL for specific database
    database-platform: org.hibernate.dialect.PostgreSQL10Dialect
    hibernate:
      # DDL (Data Definition Language) - auto generates tables
      # validate: checks schema matches entities (safe for prod)
      # update: updates schema (use only in dev)
      ddl-auto: validate
    properties:
      hibernate:
        # Format generated SQL for readability
        format_sql: true
        # Log generated SQL statements
        use_sql_comments: true
        # Batch operations for performance
        jdbc:
          batch_size: 20
          fetch_size: 50
    show-sql: false
    open-in-view: false

  # ==================== DATASOURCE ====================
  # Database connection configuration
  datasource:
    url: jdbc:postgresql://localhost:5432/admin_portal
    username: admin
    password: password
    driver-class-name: org.postgresql.Driver
    
    # Connection pool settings - manages database connections
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      auto-commit: true


  # ==================== SECURITY ====================
  # Spring Security settings
  security:
    user:
      name: admin  # TODO: YES, Going to Change this
      password: admin  # TODO: YES, Going to Change this


  # ==================== JACKSON ====================
  # JSON serialization/deserialization configuration
  jackson:
    # Include only non-null fields in JSON responses
    default-property-inclusion: non_null
    # Format timestamps as ISO-8601 strings
    serialization:
      write-dates-as-timestamps: false
    # Handle unknown properties gracefully
    deserialization:
      fail-on-unknown-properties: false

  # ==================== LOGGING ====================
  # Application logging configuration
  main:
    lazy-initialization: true


# ==================== LOGGING LEVELS ====================
# Control verbosity of logs from different packages
logging:
  level:
    root: INFO
    com.adminportal: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/application.log
    max-size: 10MB
    max-history: 10


# ==================== SERVER ====================
# Embedded Tomcat configuration
server:
  port: 8080
  servlet:
    context-path: /api
  error:
    # Include detailed error information in responses
    include-message: always
    include-binding-errors: always
    include-stacktrace: on_param
    include-exception: false

# ==================== ACTUATOR ====================
# Spring Boot Actuator - monitoring and management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

# ==================== SPRINGDOC-OPENAPI ====================
# Swagger/OpenAPI documentation configuration
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha
  api-docs:
    path: /v3/api-docs
  show-actuator: false

# ==================== JWT CONFIGURATION ====================
# Custom JWT settings (loaded into JwtConfig bean)
jwt:
  secret: your-super-secret-key-change-this-in-production-at-least-32-characters-long
  expiration: 3600000  # 60 minutes in milliseconds
  refresh-expiration: 604800000  # 7 days in milliseconds

---




# ============================================================================
# PROFILE: dev
# Development-specific configuration - uses H2 in-memory database
# ============================================================================

spring:
  config:
    activate:
      on-profile: dev
  
  jpa:
    hibernate:
      ddl-auto: create-drop  # Create tables on startup, drop on shutdown
    show-sql: true
  
  datasource:
    url: jdbc:h2:mem:admin_portal_dev
    username: sa
    password:
    driver-class-name: org.h2.Driver
    h2:
      console:
        enabled: true
        path: /h2-console

  jackson:
    default-property-inclusion: non_null

logging:
  level:
    root: INFO
    com.adminportal: DEBUG
    org.springframework: DEBUG
    org.hibernate.SQL: DEBUG

server:
  port: 8080
---



# ============================================================================
# PROFILE: prod
# Production-specific configuration - uses PostgreSQL, strict validation
# ============================================================================

spring:
  config:
    activate:
      on-profile: prod
  
  jpa:
    hibernate:
      ddl-auto: validate  # Never modify schema in production
    show-sql: false
  
  datasource:
    url: ${DB_URL:jdbc:postgresql://postgres:5432/admin_portal}
    username: ${DB_USERNAME:admin}
    password: ${DB_PASSWORD:password}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5

  jackson:
    default-property-inclusion: non_empty

logging:
  level:
    root: WARN
    com.adminportal: INFO

server:
  port: 8080
  compression:
    enabled: true
    min-response-size: 1024
---
